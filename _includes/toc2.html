{% capture tocWorkspace %}
    {% comment %}
        Version 1.0.6
          https://github.com/allejo/jekyll-toc

        "...like all things liquid - where there's a will, and ~36 hours to spare, there's usually a/some way" ~jaybe

        Usage:
            {% include toc.html html=content sanitize=true class="inline_toc" id="my_toc" h_min=2 h_max=3 %}

        Parameters:
            * html         (string) - the HTML of compiled markdown generated by kramdown in Jekyll

        Optional Parameters:
            * sanitize     (bool)   : false  - when set to true, the headers will be stripped of any HTML in the TOC
            * class        (string) :   ''   - a CSS class assigned to the TOC
            * id           (string) :   ''   - an ID to assigned to the TOC
            * h_min        (int)    :   2    - the minimum TOC header level to use; any header lower than this value will be ignored
            * h_max        (int)    :   6    - the maximum TOC header level to use; any header greater than this value will be ignored
            * ordered      (bool)   : false  - when set to true, an ordered list will be outputted instead of an unordered list
            * item_class   (string) :   ''   - add custom class(es) for each list item; has support for '%level%' placeholder, which is the current heading level
            * baseurl      (string) :   ''   - add a base url to the TOC links for when your TOC is on another page than the actual content
            * anchor_class (string) :   ''   - add custom class(es) for each anchor element

        Output:
            An ordered or unordered list representing the table of contents of a markdown block. This snippet will only
            generate the table of contents and will NOT output the markdown given to it
    {% endcomment %}


{% capture newline %}
{% endcapture %}

    {% capture my_toc %}{% endcapture %}

    {% assign orderedList = include.ordered | default: false %}
    {% assign minHeader = include.h_min | default: 2 %}
    {% assign maxHeader = include.h_max | default: 6 %}
    {% assign nodes = include.html | split: '<h' %}{%- comment -%} Find All Headings {%- endcomment -%}
    {% assign firstHeader = true %}

    {% capture listModifier %}{% if orderedList %}1. {% else %}- {% endif %}{% endcapture %}

    {% assign prevIndent = 0 %}
    {% for node in nodes %}
        {% if node == "" %}{% continue %}{% endif %}

        {% assign headerLevel = node | replace: '"', '' | slice: 0, 1 | times: 1 %}
        {% if headerLevel < minHeader or headerLevel > maxHeader %} {% continue %} {% endif %}

        {% if firstHeader %}
            {% assign firstHeader = false %}
            {% assign minHeader = headerLevel %}
        {% endif %}
        
        {%- comment -%} Find heading id {%- endcomment -%}
        {% assign indentAmount = headerLevel | minus: minHeader | add: 1 %}
        {% assign _workspace = node | split: '</h' %}
        {% assign _idWorkspace = _workspace[0] | split: 'id="' %}
        {% assign _idWorkspace = _idWorkspace[1] | split: '"' %}
        {% assign html_id = _idWorkspace[0] %}

        {% capture _hAttrToStrip %}{{ _workspace[0] | split: '>' | first }}>{% endcapture %}

        {% assign header = _workspace[0] | replace: _hAttrToStrip, '' %}
        {% if include.sanitize %}{{ assign header = header | strip_html }}{% endif %}

        {% assign space = '' %}
        {% for i in (1..indentAmount) %}
            {% assign space = space | prepend: '    ' %}
        {% endfor %}

        {% unless include.item_class == blank %}
            {% capture liClass %}{:.{{ include.item_class | replace: '%level%', headerLevel }}}{% endcapture %}
        {% endunless %}

        {% capture a_name %} [{{ header }}]{% endcapture %}
        {% capture a_url %}({% if include.baseurl %}{{ include.baseurl }}{% endif %}#{{ html_id }}){% endcapture %}
        {% capture a_class %}{% if include.anchor_class %}{:.{{ include.anchor_class }}}{% endif %}{% endcapture %}
        {% capture li %}{{newline}}{{space}}{{listModifier}}{{liClass}}{{a_name}}{{a_url}}{{a_class}}{% endcapture %} 

        {% if prevIndent > indentAmount %}
           {% capture my_toc %}{{my_toc}}{{newline}}{{space | append: '    '}}{:.{{ include.class }}}{% endcapture %}
        {% endif %}

        {% capture my_toc %}{{my_toc}}{{li}}{% endcapture %}
        {% assign prevIndent = indentAmount %}

    {% endfor %}

    {% for i in (0..indentAmount) %}
        {% assign spacesCount = indentAmount | minus: i %}
        {% assign space = '' %}
        {% for i in (1..spacesCount) %}
            {% assign space = space | append: '    ' %}
        {% endfor %}

        {% capture my_toc %}{{my_toc}}{{newline}}{{space}}{:.{{ include.class }}}{% endcapture %}
    {% endfor %}

    {% if include.id %}
        {% capture my_toc %}{: #{{ include.id }}}{{newline}}{{ my_toc | lstrip }}{% endcapture %}
    {% endif %}

{% endcapture %}
{% assign tocWorkspace = '' %}
{{ my_toc | markdownify | strip }}