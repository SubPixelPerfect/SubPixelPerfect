{%- comment -%} 

    на главной индекс показывает только избанное
    на внутренних индекс показывает всё в текущей папке 

{%- endcomment -%}

{% if page.url != '/' %}
    {%- assign _currentFolderPages = _pages | where: "dir", page.dir -%}
{%- else -%}
     {%- assign _currentFolderPages = _pages -%}
{%- endif -%}

{%- for p in _currentFolderPages -%}
    {%- comment -%} {%- if p.name == "index.md" -%}{%- continue -%}{%- endif -%}         {%- endcomment -%}
    {%- if p.hidden -%}{%- continue -%}{%- endif -%}
    {%- include page-preview.liquid page = p -%}        
{%- endfor -%}